# 代码的整洁之道
> 在开始代码之前，如果能够浏览该部分内容；在开始代码之后，能够检查自己的代码是否保持整洁，将其养成一种代码书写的习惯，这本身就是一种智慧。

每一篇代码都应该是一篇蕴含着作者解决问题思考逻辑的散文，即使不懂代码的读者都应该能够行云流水般的阅读，从而能够有个大概的认知，知道作者想要解决什么问题，和大概是怎么解决的。很多语言书籍中，尤其入门或者大部头的手册如果不提及代码的整洁之道，会使得读者走上一些弯路，这尤其表现于初学者身上，因此梳理一些关键事项，以备参考。

* **变量的命名应能反映变量本身的意义**

代码书写时为了图一时方便，往往不注重变量名的命名，而是随意的起名，例如代码行中充斥着x、y、i、j、k等单个变量名，以及jh,ik等不反映变量名意义的字母组合，待多日之后，需要返回来应用代码或者迁移代码于新项目中时，无法快速的理解变量的意义，即代码可读性很差，从而会浪费时间再度理解，以及为他人迁移应用该代码形成阻碍。

在变量名命名时，建议的形式包括三种：

一是单个词，例如`markers=['.','+','o','^','x','s']`,这是应用matplotlib图表库打印图表时，定义图表的标记类型所定义的类型列表，其名字能够反映所要表述变量的意义。

二是字母组合，其一为`landmarkPts=[Point(coordi[0],coordi[1]) for coordi in np.stack((landmarks[0], landmarks[1]), axis=-1)]`中的`landmarkPts`，或者不引入缩写为`landmarkPoints`，即直接可以理解该变量名为地标点，其形式为字母组合时后一字母首字母大写；其二是，`landmark_pts`或者`landmark_points`，即多个字母组合时中间以下短划线隔离，后以字母的首字母不需大写。

* **给出关键的注释**

“烂笔头”的重要性无需质疑，虽然好的变量名能够一定程度上解释语句的意义，但是解决问题的逻辑通常需要给与注释（使用# 或者\``` note \```），尤其一些关键的思考。例如对函数功能的注释：
```python
'''
以文件夹名为键，值为包含该文件夹下所有文件名的列表。文件类型可以自行定义
'''
def filePath(dirpath,fileType):
    fileInfo={}
    ...
```
以及对关键语句的解释：
```python
 idx = tempDf[ tempDf['cluster'] == -1 ].index  #删除字段“cluster”值为-1对应的行，即独立的OSM点数据，未形成聚类
 tempDf.drop(idx,inplace=True)  
```
如果以上示例中不给出注释，那么就不能立刻在头脑中反映出这些语句是做什么的，就不得不花费大精力来前后推断，甚至不得不阅读整段代码。当然，要以函数或变量取合适的名字为先，注释补充为后，而不应该是草草的变量名，和成堆的注释，这就本末倒置了。

* **尽量保持定义的一个函数仅作一件事情，以及最小的迁移代价**

每一段函数代码都是解决某一问题的一种方法，很多的时候在同一项目、或不同项目中这种方法会不断重复被使用，因此该函数应该能够以最少的代价来迁移，即无需或者少改动代码就可立即使用。通常的时候我们会不注意到，在单独的函数内部包含了全局变量，迁移后就会提示全局变量未定义的情况，因此建议函数定义时，尽量通过函数参数传递变量；同时，在单独函数命名，以及函数内变量的命名时，尽量保持名称的通用性，避免迁移后名字只能反映当初项目的内容，例如,`def ffill(arr):`函数`ffill()`表示向前填充数组中的空数据，如果函数名以及参数名改为具体的`def landmarks_ffill(landmarks_arr)`，迁移后的变量可能不是`landmarks`，就会容易引起歧义，造成代码阅读上的干扰。

而一个函数最好仅做一件事情的目的，也是保持代码具有更好的易读性和可迁移性。这个并不难以理解，如果该函数可以同时做多件事情，尤其很难划分为一类的事情，而其它项目仅需要该函数的部分功能时，事情就会变得复杂起来。

* **复杂的程序要学会使用类和分文件——系统的思维**

代码是可以在不知不觉中变得复杂起来，一不小心少则千行，多则万行，那么所有代码位于一个文件中，或者包含有数十个单独的函数，代码的管理就很成问题，因此学会应用类来组织具有相关属性的函数，以及多个分文件来切分代码，在主文件中只是引用，例如`import driverlessCityProject_spatialPointsPattern_association_basic as basic`，将文件引入并取别名为`basic`来使用代码，那么代码的结构就会比较清晰，也避免了处于同一文件中，不容易查找的弊病。

类和分文件只是系统思维表现的一种手段，而对于项目的所有代码的组织，确定数据的流动走向，前后关联层级的配置，整体结构的把握，才能够保证代码的稳健性（robustness）。

> 很喜欢《代码的整洁之道》Robert C. Martin.<em>Clean Code: A Handbook of Agile Software Craftsmanship</em>[M].U.S. Prentice Hall.August 11,2008. 这本阐述代码哲理的书，不管是刚刚进入代码领域，还是早已浸淫多年，通读后，再偶尔翻一番，都会对自己的“武道之心”又有所坚持。